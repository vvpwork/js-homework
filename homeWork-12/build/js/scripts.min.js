"use strict";var APP_KEY="5b93d8100e62278344b8abff221294244b92ecbf5b0bd",refs={form:document.querySelector(".form"),input:document.querySelector(".form__input"),list:document.querySelector(".url__list"),temp:document.querySelector(".url__templates").innerHTML.trim(),urlPreview:"http://api.linkpreview.net",urlTest:/\b(?:(?:https?|ftp|http):\/\/|www\.)[-a-z0-9+&@#\/%?=~_|!:,.;]*[-a-z0-9+&@#\/%=~_|]/i,url:[],tempArr:[]};function handlerDeletList(e){var r=e.target;if("BUTTON"===r.nodeName){var t=r.closest(".url__items");deletUrl(t.querySelector(".url__address").innerHTML,t)}}function hendlerSubmit(e){e.target;var r=refs.input.value;return refs.url.includes(r)?alert("такая закладка уже существует"):refs.urlTest.test(r)?(refs.url.push(r),void tamplete(refs.url)):alert("не вверный ввод урла")}function preview(e){return fetch(refs.urlPreview+"/?key="+APP_KEY+"&q="+e).then(function(e){if(e.ok)return e.json();throw new Error("error:"+e.statusText)})}function tamplete(e){refs.tempArr=[],e.map(function(e){preview(e).then(function(e){return refs.tempArr.push(e),refs.tempArr}).then(function(e){return past(e)}).catch(function(e){return console.log(e)})})}function past(e){var t=Handlebars.compile(refs.temp),r=e.reduce(function(e,r){return e+t(r)},"");refs.list.innerHTML=r}function deletUrl(e,r){new Promise(function(e,r){e(refs.url.map(function(e){refs.url.splice(refs.url.indexOf(e),1)})),r("error")}).then(function(e){return r.innerHTML=""}).catch(function(e){return console.log(e)})}refs.form.addEventListener("submit",hendlerSubmit),refs.list.addEventListener("click",handlerDeletList);