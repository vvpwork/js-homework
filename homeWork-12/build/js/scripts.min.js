"use strict";var APP_KEY="5b93d8100e62278344b8abff221294244b92ecbf5b0bd",refs={form:document.querySelector(".form"),input:document.querySelector(".form__input"),list:document.querySelector(".url__list"),temp:document.querySelector(".url__templates").innerHTML.trim(),urlPreview:"http://api.linkpreview.net",urlTest:/\b(?:(?:https?|ftp|http):\/\/|www\.)[-a-z0-9+&@#\/%?=~_|!:,.;]*[-a-z0-9+&@#\/%=~_|]/i,url:[],tempArr:[]};function handlerDeletList(e){var t=e.target;if("BUTTON"===t.nodeName){var r=t.closest(".url__items");deletUrl(r.querySelector(".url__address").innerHTML,r),setLocalStorageObjectItem("urlList",refs.tempArr)}}function hendlerSubmit(e){e.target;var t=refs.input.value;return refs.url.includes(t)?alert("такая закладка уже существует"):refs.urlTest.test(t)?(refs.url.push(t),void template(refs.url)):alert("не вверный ввод урла")}function preview(e){return fetch(refs.urlPreview+"/?key="+APP_KEY+"&q="+e).then(function(e){if(e.ok)return e.json();throw new Error("error:"+e.statusText)})}function template(e){refs.tempArr=[],setLocalStorageObjectItem("urlList",e),e.map(function(e){preview(e).then(function(e){return refs.tempArr.push(e),refs.tempArr}).then(function(e){return past(e)}).catch(function(e){return console.log(e)})})}function past(e){var r=Handlebars.compile(refs.temp),t=e.reduce(function(e,t){return e+r(t)},"");refs.list.innerHTML=t}function deletUrl(e,t){new Promise(function(e,t){e(refs.url.map(function(e){refs.url.splice(refs.url.indexOf(e),1)})),t("error")}).then(function(e){return t.innerHTML=""}).catch(function(e){return console.log(e)})}function setLocalStorageObjectItem(e,t){void 0===t?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(t))}function getLocalStorageObjectItem(e){var t=localStorage.getItem(e);if(void 0!==t)return JSON.parse(t)}refs.form.addEventListener("submit",hendlerSubmit),refs.list.addEventListener("click",handlerDeletList);var localUrlList=Array.from(getLocalStorageObjectItem("urlList"));function startDec(e){e.map(function(e){refs.url.push(e.url)}),template(refs.url)}startDec(localUrlList);