"use strict";var APP_KEY="5b93d8100e62278344b8abff221294244b92ecbf5b0bd",refs={form:document.querySelector(".form"),input:document.querySelector(".form__input"),list:document.querySelector(".url__list"),temp:document.querySelector(".url__templates").innerHTML.trim(),urlPreview:"http://api.linkpreview.net",urlTest:/\b(?:(?:https?|ftp|http):\/\/|www\.)[-a-z0-9+&@#\/%?=~_|!:,.;]*[-a-z0-9+&@#\/%=~_|]/i,url:[],tempArr:[]};function handlerDeletList(e){var r=e.target;if("BUTTON"===r.nodeName){var t=r.closest(".url__items");deletUrl(t.querySelector(".url__address").innerHTML,t),setLocalStorageObjectItem("urlList",refs.tempArr)}}function hendlerSubmit(e){e.target;var r=slesh(refs.input.value);return refs.urlTest.test(r)?refs.url.includes(r)?alert("this url is added"):(refs.url.push(r),void template(refs.url)):alert("error: undefined url")}function template(e){refs.tempArr=[],e.map(function(e){preview(e).then(function(e){return refs.tempArr.push(e),refs.tempArr}).then(function(e){return past(e)}).catch(function(e){return console.log(e)})})}function preview(e){return fetch(refs.urlPreview+"/?key="+APP_KEY+"&q="+e).then(function(e){if(e.ok)return e.json();throw new Error("error:"+e.statusText)})}function past(e){var t=Handlebars.compile(refs.temp),r=e.reduce(function(e,r){return e+t(r)},"");refs.list.innerHTML=r,setLocalStorageObjectItem("urlList",refs.url)}function deletUrl(t,r){new Promise(function(e,r){e(refs.url.map(function(e){t==e&&(refs.url.splice(refs.url.indexOf(e),1),setLocalStorageObjectItem("urlList",refs.url))})),r("error")}).then(function(e){r.innerHTML=""}).catch(function(e){return console.log(e)})}function setLocalStorageObjectItem(e,r){void 0===r?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(r))}function getLocalStorageObjectItem(e){var r=localStorage.getItem(e);if(void 0!==r)return JSON.parse(r)}function slesh(e){return"/"!==e.slice(-1)?e+"/":e}refs.form.addEventListener("submit",hendlerSubmit),refs.list.addEventListener("click",handlerDeletList),refs.url=Array.from(getLocalStorageObjectItem("urlList")),template(refs.url);